<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details - TalentLink</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
    .btn-apply {
      background-color: #4a6cf7;
      color: #fff;
      border: none;
      padding: 1rem 2.5rem;
      border-radius: 6px;
      font-size: 1.15rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(74, 108, 247, 0.10);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      margin: 1rem 0 0 0;
    }
    .btn-apply:hover, .btn-apply:focus {
      background-color: #274bb6;
      box-shadow: 0 4px 16px rgba(74, 108, 247, 0.18);
      transform: translateY(-2px) scale(1.03);
    }
    .btn-apply .material-icons {
      font-size: 1.3em;
      vertical-align: middle;
    }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">TalentLink</a>
            <div class="nav-links" id="navLinks">
                <a href="index.html">Home</a>
                <a href="jobs.html">Jobs</a>
                <a href="#companies">Companies</a>
                <a href="my-applications.html" id="applicationsLink">Your Applications</a>
                <!-- Post a Job Button - Only visible to employers -->
                <a href="post-job.html" class="btn btn-primary" id="postJobBtn" style="display: none; margin-left: 10px;">
                    <i class="material-icons" style="font-size: 16px; vertical-align: middle; margin-right: 4px;">add</i>
                    Post a Job
                </a>
                <!-- Auth State Container - Will be managed by auth.js -->
                <div id="authState">
                    <!-- Login/Signup Buttons (Shown when not logged in) -->
                    <div class="auth-buttons" id="authButtons">
                        <a href="login.html" class="btn btn-outline" id="loginLink">Login</a>
                        <a href="signup.html" class="btn btn-primary" id="registerLink">Sign Up</a>
                    </div>
                    <!-- User Menu (Shown when logged in) -->
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <div class="user-dropdown">
                            <button class="user-avatar" id="userAvatar">
                                <span class="material-icons">account_circle</span>
                                <span id="userInitials" class="user-initials"></span>
                            </button>
                            <div class="dropdown-content" id="dropdownMenu">
                                <div class="user-info">
                                    <div id="userName" class="user-name">Loading...</div>
                                    <div id="userEmail" class="user-email"></div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <a href="profile.html"><i class="material-icons">person</i> My Profile</a>
                                <a href="my-jobs.html"><i class="material-icons">work</i> My Jobs</a>
                                <a href="settings.html"><i class="material-icons">settings</i> Settings</a>
                                <div class="dropdown-divider"></div>
                                <a href="#" id="logoutBtn"><i class="material-icons">logout</i> Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <button class="hamburger" id="hamburger">
                <span class="material-icons">menu</span>
            </button>
        </div>
    </nav>

    <!-- Job Details Section -->
    <main class="container" style="margin-top: 6rem;">
        <div style="margin-top: 2.5rem; margin-bottom: 1.5rem;">
            <button onclick="window.history.back()" class="btn btn-outline">
                <i class="material-icons">arrow_back</i> Back
            </button>
        </div>
        <div id="jobDetails" class="job-details-card loading">
            <div class="spinner"></div>
            <p>Loading job details...</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <h3>TalentLink</h3>
                    <p>Connecting top talent with leading companies worldwide. Find your dream job or your next great hire today.</p>
                </div>
                <div class="footer-links">
                    <h4>For Job Seekers</h4>
                    <a href="#">Browse Jobs</a>
                    <a href="#">Create Profile</a>
                    <a href="#">Career Resources</a>
                </div>
                <div class="footer-links">
                    <h4>For Employers</h4>
                    <a href="#">Post a Job</a>
                    <a href="#">Browse Candidates</a>
                    <a href="#">Pricing</a>
                </div>
                <div class="footer-contact">
                    <h4>Contact Us</h4>
                    <p>Email: info@talentlink.com</p>
                    <p>Phone: (123) 456-7890</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook">FB</a>
                        <a href="#" aria-label="Twitter">TW</a>
                        <a href="#" aria-label="LinkedIn">IN</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 TalentLink. All rights reserved.</p>
                <div class="legal-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Cookie Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        // Update applications link text based on user type
        function updateApplicationsLink() {
            const applicationsLink = document.getElementById('applicationsLink');
            if (applicationsLink && window.TalentLink?.auth) {
                const isEmployer = window.TalentLink.auth.isEmployer();
                applicationsLink.textContent = isEmployer ? 'Applications' : 'My Applications';
            }
        }
        
        // Update on auth state change
        window.addEventListener('authStateChange', updateApplicationsLink);
        
        // Initial update
        setTimeout(updateApplicationsLink, 100);
        
        const api = window.TalentLink && window.TalentLink.api;
        const jobDetailsDiv = document.getElementById('jobDetails');
        // Get job ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('id');
        if (!jobId) {
            jobDetailsDiv.innerHTML = '<div class="error-message"><i class="material-icons">error_outline</i> <p>Job not found.</p></div>';
            return;
        }
        try {
            const job = await api.jobs.getById(jobId);
            jobDetailsDiv.classList.remove('loading');
            let applyButton = '';
            let user = null;
            try {
              user = JSON.parse(localStorage.getItem('user'));
            } catch (e) {}
            let alreadyApplied = false;
            if (user && (user.user_type === 'candidate' || user.user_type === 'job_seeker' || user.is_candidate)) {
              // Check if user already applied
              let myApplications = [];
              try {
                myApplications = await api.jobs.getMyApplications();
                // Normalize to array
                if (!Array.isArray(myApplications)) {
                  if (myApplications && myApplications.results && Array.isArray(myApplications.results)) {
                    myApplications = myApplications.results;
                  } else if (myApplications && myApplications.data && Array.isArray(myApplications.data)) {
                    myApplications = myApplications.data;
                  } else {
                    myApplications = [];
                  }
                }
                alreadyApplied = myApplications.some(app => String(app.job_posting) === String(job.id));
              } catch (e) {
                console.warn('Could not load user applications:', e);
              }
              if (alreadyApplied) {
                applyButton = `
                  <button class="btn-apply" id="applyNowBtn" data-job-id="${job.id}" disabled style="background:#bdbdbd;cursor:not-allowed;">
                    <i class="material-icons">check_circle</i> Applied
                  </button>
                `;
              } else {
                applyButton = `
                  <button class="btn-apply" id="applyNowBtn" data-job-id="${job.id}">
                    <i class="material-icons">send</i> Apply Now
                  </button>
                `;
              }
              // Add click handler for Apply Now button after the content is loaded
              setTimeout(() => {
                const applyBtn = document.getElementById('applyNowBtn');
                if (applyBtn && !applyBtn.disabled) {
                  applyBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const jobId = this.getAttribute('data-job-id');
                    // Check if user is logged in
                    let user = null;
                    try {
                      const userData = localStorage.getItem('user');
                      if (userData) user = JSON.parse(userData);
                    } catch (e) {}
                    if (!user || !user.id) {
                      // Redirect to login with return URL
                      window.location.href = 'login.html?redirect=' + encodeURIComponent('application.html?jobId=' + jobId);
                      return;
                    }
                    // Redirect to application page
                    window.location.href = 'application.html?jobId=' + jobId;
                  });
                }
              }, 100);
            }
            jobDetailsDiv.innerHTML = `
                <div class="job-details-header">
                    <div class="company-logo" style="background-color: #4361ee; width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 2rem; color: #fff;">
                        ${job.company_name ? job.company_name.charAt(0).toUpperCase() : '?'}
                    </div>
                    <div class="job-details-header-text">
                        <h2>${job.title}</h2>
                        <div class="job-company">${job.company_name || ''}</div>
                        <div class="job-meta">
                            <span><i class="material-icons">location_on</i> ${job.location}</span>
                            <span><i class="material-icons">attach_money</i> ${job.salary || 'N/A'}</span>
                            <span><i class="material-icons">work_outline</i> ${job.job_type || ''}</span>
                            <span><i class="material-icons">calendar_today</i> Posted: ${job.created_at ? new Date(job.created_at).toLocaleDateString() : ''}</span>
                        </div>
                        ${applyButton}
                    </div>
                </div>
                <div class="job-details-body">
                    <h3>Description</h3>
                    <p>${job.description || ''}</p>
                    <h3>Requirements</h3>
                    <p>${job.requirements || ''}</p>
                    <h3>Skills</h3>
                    <div class="job-skills">
                        ${(job.skills && job.skills.length > 0) ? job.skills.map(skill => `<span class="skill-tag">${skill}</span>`).join('') : '<span>No skills listed.</span>'}
                    </div>
                    <h3>Benefits</h3>
                    <p>${job.benefits || 'Not specified.'}</p>
                    <h3>Application Deadline</h3>
                    <p>${job.application_deadline || 'Not specified.'}</p>
                </div>
                ${applyButton ? `<div style="text-align:center; margin:2.5rem 0 0 0;">${applyButton}</div>` : ''}
            `;
        } catch (error) {
            jobDetailsDiv.innerHTML = `<div class="error-message"><i class="material-icons">error_outline</i> <p>Failed to load job details.</p></div>`;
        }
    });
    </script>
</body>
</html> 